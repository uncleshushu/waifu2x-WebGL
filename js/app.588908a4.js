(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)s=o[d],i[s]&&f.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},i={app:0},r=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/waifu2x-WebGL/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([1,"chunk-vendors"]),n()})({0:function(e,t){},1:function(e,t,n){e.exports=n("56d7")},2:function(e,t){},3:function(e,t){},"3a4c":function(e,t,n){"use strict";var a=n("76bc"),i=n.n(a);i.a},4:function(e,t){},5:function(e,t){},5547:function(e,t,n){e.exports=n.p+"img/tom.4cc0b41c.jpg"},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),i=n("bb71");n("da64");a["a"].use(i["a"],{iconfont:"md"});var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{attrs:{id:"waifu2x"}},[n("v-toolbar",{attrs:{app:"",color:"pink lighten-2"}},[n("v-toolbar-title",{staticClass:"headline text-uppercase"},[n("span",[e._v("waifu2x")]),n("span",{staticClass:"font-weight-light"},[e._v("-WebGL")])]),n("v-spacer"),n("v-btn",{attrs:{flat:"",href:"https://github.com/uncleshushu/waifu2x-WebGL",target:"_blank"}},[n("span",{staticClass:"mr-2"},[e._v("Github Repo")])])],1),n("v-content",[n("v-container",{attrs:{fluid:"","grid-list-lg":""}},[n("v-layout",{attrs:{"justify-center":""}},[n("v-flex",{attrs:{md10:"",lg8:"",xl6:""}},[n("v-card",{attrs:{color:"teal lighten-5"}},[n("v-container",{attrs:{fluid:"","grid-list-lg":""}},[n("v-layout",{attrs:{"justify-center":"","align-center":"",row:"",wrap:""}},[n("v-flex",{attrs:{xs8:"",sm6:""}},[n("SettingPanel",{ref:"settingPanel",attrs:{"default-model-selected":e.waifu2xModelNameSelected,"model-names":e.waifu2xModelNames,"default-image-filename":e.defaultImageFileName,"download-link":e.downloadLink,state:e.state},on:{"file-change":e.onFileChange,"model-change":e.onModelChange,"waifu2x-start":e.onWaifu2xStart}})],1),n("v-flex",{attrs:{xs6:""}},[n("ImagePreview",{ref:"preview",attrs:{src:e.imageSrc}})],1),n("v-flex",{attrs:{xs12:""}},[n("ProcessingCanvas",{ref:"canvas",attrs:{imgsrc:e.imageSrc,"processing-function":e.waifu2xProcessingFunction,state:e.state},on:{"processing-complete":e.onWaifu2xComplete}})],1)],1)],1)],1)],1)],1)],1)],1)],1)},s=[],o=(n("96cf"),n("3b8d")),c=n("a4bb"),l=n.n(c),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",[n("v-container",{attrs:{fluid:"","grid-list-md":""}},[n("v-layout",{attrs:{"justify-sapce-between":"","align-center":"",row:"",wrap:""}},[n("v-flex",{attrs:{sm6:""}},[n("div",[e._v("Choose an image")]),n("v-btn",{attrs:{disabled:e.fileInputDisabled,block:"",depressed:""},on:{click:function(t){return e.$refs.fileInput.click()}}},[e._v("\n          "+e._s(e.imageFilenameDisplay)+"\n          "),n("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.onFileChange}})])],1),n("v-flex",{attrs:{sm6:""}},[n("div",[e._v("Select a method")]),n("v-select",{staticClass:"compact-v-select",attrs:{disabled:e.modelSelectDisabled,items:e.modelNames},on:{change:e.onModelChange},model:{value:e.modelSelected,callback:function(t){e.modelSelected=t},expression:"modelSelected"}})],1),n("v-flex",{attrs:{sm6:""}},[n("v-btn",{staticClass:"pink--text",attrs:{disabled:e.startDisabled,block:"",round:""},on:{click:function(t){return e.onWaifu2xStart()}}},[e._v("\n          "+e._s(e.startButtonText)+"\n        ")])],1),n("v-flex",{attrs:{sm6:""}},[n("v-btn",{staticClass:"teal--text",attrs:{disabled:e.downloadDisabled,block:"",round:""},on:{click:function(t){return e.$refs.downloadAnchor.click()}}},[e._v("\n          Download\n          "),n("v-icon",{attrs:{right:""}},[e._v("cloud_download")]),n("a",{ref:"downloadAnchor",attrs:{href:e.downloadLink,download:e.processedImageFileName}})],1)],1)],1)],1)],1)},d=[],f=(n("7f7f"),n("c5f6"),{props:{modelNames:Array,defaultModelSelected:String,defaultImageFilename:String,state:Number,downloadLink:String},data:function(){return{modelSelectDisabled:!1,modelSelected:this.defaultModelSelected,fileInputDisabled:!1,imageFileName:this.defaultImageFilename,imageSrc:null,startDisabled:!1,startButtonText:"Run waifu2x",downloadDisabled:!0}},computed:{imageName:function(){return this.imageFileName.substring(0,this.imageFileName.lastIndexOf("."))},imageFilenameDisplay:function(){if(this.imageName.length>8){var e=this.imageFileName.substring(this.imageFileName.lastIndexOf("."));return this.imageName.substring(0,3)+"..."+this.imageName.substring(this.imageName.length-3)+e}return this.imageFileName},processedImageFileName:function(){return this.imageName+"_"+this.modelSelected+".png"}},watch:{state:function(){switch(this.state){case this.STATE.BEFORE_PROCESSING:this.startButtonText="Run waifu2x",this.downloadDisabled=!0;break;case this.STATE.PROCESSING:this.startDisabled=!0,this.startButtonText="Running...",this.fileInputDisabled=!0,this.modelSelectDisabled=!0,this.downloadDisabled=!0;break;case this.STATE.AFTER_PROCESSING:this.startDisabled=!1,this.startButtonText="Rerun waifu2x",this.fileInputDisabled=!1,this.modelSelectDisabled=!1,this.downloadDisabled=!1;break}}},methods:{onWaifu2xStart:function(){this.$emit("waifu2x-start")},onModelChange:function(){this.$emit("model-change",this.modelSelected)},onFileChange:function(e){var t=e.target.files[0];this.imageFileName=t.name,window.URL.revokeObjectURL(this.imageSrc),this.imageSrc=window.URL.createObjectURL(t),this.$emit("file-change",this.imageSrc)}}}),h=f,m=(n("6e88"),n("2877")),p=n("6544"),g=n.n(p),v=n("8336"),w=n("b0af"),b=n("a523"),x=n("0e8f"),S=n("132d"),_=n("a722"),R=n("b56d"),I=Object(m["a"])(h,u,d,!1,null,null,null),O=I.exports;g()(I,{VBtn:v["a"],VCard:w["a"],VContainer:b["a"],VFlex:x["a"],VIcon:S["a"],VLayout:_["a"],VSelect:R["a"]});var E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",[n("v-img",{attrs:{src:e.src}})],1)},y=[],T={props:{src:String},data:function(){return{}}},M=T,C=n("adda"),N=Object(m["a"])(M,E,y,!1,null,null,null),P=N.exports;g()(N,{VCard:w["a"],VImg:C["a"]});var k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",{ref:"vcard"},[n("canvas",{ref:"canvas"}),n("v-card-title",{attrs:{"primary-title":""}},[n("span",[e._v("State: "+e._s(e.stateString))]),n("v-spacer"),n("span",[e._v("Original Size: "+e._s(e.image.width)+" × "+e._s(e.image.height))])],1),n("v-card-title",{attrs:{"primary-title":""}},[n("span",[e._v("Time: "+e._s(e.wallTimeSecond)+" s")]),n("v-spacer"),n("span",[e._v("Scaled Size: "+e._s(2*e.image.width)+" × "+e._s(2*e.image.height))])],1)],1)},F=[],A={props:{imgsrc:String,processingFunction:Function,state:Number},data:function(){return{stateString:"Before processing",image:new Image,processedImageURL:null,kernelTimeSecond:0,wallTimeSecond:0}},computed:{canvas:function(){return this.$refs.canvas},context2D:function(){return this.canvas.getContext("2d")}},watch:{imgsrc:function(){var e=this,t=new Image;t.src=this.imgsrc,t.onload=function(){e.image=t,e.preview()}},state:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=this.state,e.next=e.t0===this.STATE.BEFORE_PROCESSING?3:e.t0===this.STATE.PROCESSING?7:e.t0===this.STATE.AFTER_PROCESSING?12:14;break;case 3:return this.stateString="Before processing",this.wallTimeSecond=0,this.preview(),e.abrupt("break",14);case 7:return this.stateString="Processing...",e.next=10,this.processImage();case 10:return this.canvas.toBlob(function(e){window.URL.revokeObjectURL(t.processedImageURL),t.processedImageURL=window.URL.createObjectURL(e),t.$emit("processing-complete",t.processedImageURL)}),e.abrupt("break",14);case 12:return this.stateString="Processing complete",e.abrupt("break",14);case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){var e=this,t=new Image;t.src=this.imgsrc,t.onload=function(){e.image=t,e.preview()}},methods:{preview:function(){this.canvas.width=2*this.image.naturalWidth,this.canvas.height=2*this.image.naturalHeight,this.context2D.globalAlpha=.5,this.context2D.drawImage(this.image,0,0,this.canvas.width,this.canvas.height)},processImage:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,n,a,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return 1==this.context2D.globalAlpha&&this.preview(),this.wallTimeSecond=0,t=performance.now(),n=setInterval(function(){return i.wallTimeSecond+=1},1e3),this.context2D.globalAlpha=1,e.next=7,this.processingFunction(this.image,this.context2D);case 7:clearInterval(n),a=performance.now(),this.wallTimeSecond=((a-t)/1e3).toFixed(2);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},D=A,j=(n("3a4c"),n("12b2")),L=n("9910"),V=Object(m["a"])(D,k,F,!1,null,"27e22f65",null),G=V.exports;g()(V,{VCard:w["a"],VCardTitle:j["a"],VSpacer:L["a"]});n("ac6a"),n("6c7b");var B=n("768b"),U=n("0b53"),W={"VGG-7":{dir_name:"waifu2x_vgg_7_scale2.0x_model_valid_padding_model",patch_size:64,margin_size:7,padding_method:"VALID",upscale_first:!0},"UpConv-7":{dir_name:"waifu2x_upconv_7_noise1_scale2.0x_same_padding_model",patch_size:128,margin_size:6,padding_method:"SAME",upscale_first:!1}};function z(e,t,n,a){return $.apply(this,arguments)}function $(){return $=Object(o["a"])(regeneratorRuntime.mark(function e(t,n,a,i){var r,s,o,c,l,u,d,f,h,m,p,g,v,w,b,x,S,_,R;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:console.log("memory used before processing: ".concat(U["e"]().numBytes/1024," KiB")),r=i.margin_size,s=i.patch_size,o=i.padding_method,c=i.upscale_first,l=U["g"](function(){return U["a"].fromPixels(t).expandDims().asType("float32").div(255)}),u=Object(B["a"])(l.shape,4),d=u[0],f=u[1],h=u[2],m=u[3],p=f+2*r,g=h+2*r,v=U["g"](function(){var e=U["b"]([U["h"](U["f"](l,[0,0,0,0],[d,1,h,m]),[1,r,1,1]),l,U["h"](U["f"](l,[0,f-1,0,0],[d,1,h,m]),[1,r,1,1])],1);return U["b"]([U["h"](U["f"](e,[0,0,0,0],[d,p,1,m]),[1,1,r,1]),e,U["h"](U["f"](e,[0,0,h-1,0],[d,p,1,m]),[1,1,r,1])],2)}),w=s+2*r,b=new Array(Math.ceil(f/s)).fill(0).map(function(){return new Array(Math.ceil(h/s)).fill(0)}).map(function(e,t,n){return e.map(function(e,a,i){return U["f"](v,[0,t*s,a*s,0],[d,t<n.length-1?w:p-t*s,a<i.length-1?w:g-a*s,m])})}),x=0;case 12:if(!(x<b.length)){e.next=24;break}S=b[x],_=regeneratorRuntime.mark(function e(t){var i,l,u,d,f,h,m;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=S[t],l=U["g"](function(){var e=a.predict(i).squeeze(),t=Object(B["a"])(e.shape,3),n=t[0],s=t[1],l=t[2];switch(o){case"VALID":return c?e.slice([r,r,0],[n-2*r,s-2*r,l]):e.slice([0,0,0],[n,s,l]);case"SAME":return e.slice([2*r,2*r,0],[n-4*r,s-4*r,l])}}),u=Object(B["a"])(l.shape,3),d=u[0],f=u[1],u[2],e.next=5,U["a"].toPixels(l);case 5:h=e.sent,l.dispose(),i.dispose(),m=new ImageData(h,f,d),n.putImageData(m,2*t*s,2*x*s);case 10:case"end":return e.stop()}},e)}),R=0;case 16:if(!(R<S.length)){e.next=21;break}return e.delegateYield(_(R),"t0",18);case 18:R++,e.next=16;break;case 21:x++,e.next=12;break;case 24:U["c"](v),U["c"](l),console.log("memory used after processing: ".concat(U["e"]().numBytes/1024," KiB"));case 27:case"end":return e.stop()}},e)})),$.apply(this,arguments)}function J(e){return K.apply(this,arguments)}function K(){return K=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n,a,i,r=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(n=r.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=r[i];return e.next=3,U["i"](function(){return t.apply(void 0,a)});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)})),K.apply(this,arguments)}var q={MODEL_INFO_MAP:W,enlarge:z,loadModel:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U["d"](t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),tf_time:J},H={name:"App",components:{SettingPanel:O,ImagePreview:P,ProcessingCanvas:G},data:function(){return{imageSrc:n("5547"),defaultImageFileName:"tom.jpg",waifu2xModelNames:l()(q.MODEL_INFO_MAP),waifu2xModelNameSelected:"UpConv-7",waifu2xModel:null,waifu2xProcessingFunction:null,state:this.STATE.BEFORE_PROCESSING,downloadLink:null}},created:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,q.loadModel(this.waifu2xModelPath);case 2:this.waifu2xModel=e.sent,this.waifu2xProcessingFunction=function(e,n){return q.enlarge(e,n,t.waifu2xModel,t.waifu2xModelInfo)},this.waifu2xWarmUp();case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),computed:{waifu2xModelInfo:function(){return q.MODEL_INFO_MAP[this.waifu2xModelNameSelected]},waifu2xModelPath:function(){return"".concat("/waifu2x-WebGL/","tfjs_models/").concat(this.waifu2xModelInfo.dir_name,"/model.json")},waifu2xPatchSize:function(){var e=this.waifu2xModelInfo.patch_size;return/Mobi|Android/.test(navigator.userAgent)&&(e=Math.round(e/2)),e}},methods:{onWaifu2xStart:function(){this.state=this.STATE.PROCESSING},onWaifu2xComplete:function(e){this.state=this.STATE.AFTER_PROCESSING,this.downloadLink=e},onModelChange:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.waifu2xModelNameSelected=t,this.waifu2xModel&&this.waifu2xModel.dispose(),e.next=4,q.loadModel(this.waifu2xModelPath);case 4:this.waifu2xModel=e.sent,this.waifu2xProcessingFunction=function(e,t){return q.enlarge(e,t,n.waifu2xModel,n.waifu2xModelInfo)},this.waifu2xWarmUp(),this.state=this.STATE.BEFORE_PROCESSING;case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),onFileChange:function(e){this.imageSrc=e,this.state=this.STATE.BEFORE_PROCESSING},waifu2xWarmUp:function(){var e=this,t=document.createElement("canvas");t.width=this.waifu2xPatchSize,t.height=t.width;var n=t.getContext("2d");n.fillRect(0,0,t.width,t.height);var a=new Image(t.width,t.height);a.onload=function(){t.width*=2,t.height*=2,e.waifu2xProcessingFunction(a,n)},a.src=t.toDataURL()}}},Y=H,Q=n("7496"),X=n("549c"),Z=n("71d9"),ee=n("2a7f"),te=Object(m["a"])(Y,r,s,!1,null,null,null),ne=te.exports;g()(te,{VApp:Q["a"],VBtn:v["a"],VCard:w["a"],VContainer:b["a"],VContent:X["a"],VFlex:x["a"],VLayout:_["a"],VSpacer:L["a"],VToolbar:Z["a"],VToolbarTitle:ee["a"]});var ae=n("15b8"),ie=n.n(ae),re={BEFORE_PROCESSING:0,PROCESSING:1,AFTER_PROCESSING:2};ie()(re);var se={install:function(e){e.prototype.STATE=re}};a["a"].use(se),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(ne)}}).$mount("#app")},6:function(e,t){},"6e88":function(e,t,n){"use strict";var a=n("8c1a"),i=n.n(a);i.a},7:function(e,t){},"76bc":function(e,t,n){},8:function(e,t){},"8c1a":function(e,t,n){}});
//# sourceMappingURL=app.588908a4.js.map